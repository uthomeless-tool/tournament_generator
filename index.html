<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ£ãƒ‰ãƒå¤§ä¼šãƒ«ãƒ¼ãƒ«æŠ½é¸</title>
    <style>
        :root { --primary: #3498db; --bg: #eef2f3; --card: #ffffff; --accent: #e74c3c; --success: #2ecc71; --tokkan: #9b59b6; }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; max-width: 450px; flex-wrap: wrap; }
        .tab-btn { flex: 1; min-width: 100px; padding: 12px; border: none; border-radius: 10px; background: #ddd; cursor: pointer; font-weight: bold; font-size: 0.9rem; }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-btn.active.tokkan-theme { background: var(--tokkan); }

        .container { width: 100%; max-width: 450px; display: flex; flex-direction: column; gap: 12px; }

        .how-to-use {
            background: rgba(0,0,0,0.05); padding: 12px; border-radius: 10px; margin-bottom: 15px;
            font-size: 0.8rem; color: #555; line-height: 1.5; border-left: 4px solid var(--primary);
        }
        
        /* ã‚¹ãƒ­ãƒƒãƒˆå…±é€šè¡¨ç¤º */
        .slot-row { background: var(--card); padding: 15px; border-radius: 15px; display: flex; align-items: center; gap: 15px; border: 3px solid transparent; }
        .slot-row.finished { border-color: var(--success); }
        .label { width: 70px; font-weight: bold; font-size: 0.85rem; color: #7f8c8d; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .picker-viewport { flex-grow: 1; height: 50px; overflow: hidden; position: relative; background: #222; border-radius: 8px; cursor: pointer; }
        .picker-list { position: absolute; width: 100%; top: 0; transition: transform 0.2s; }
        .picker-item { height: 50px; line-height: 50px; font-size: 1rem; font-weight: bold; text-align: center; color: #fff; padding: 0 5px; overflow: hidden; }

        /* çªè²«ãƒãƒ¼ã‚¹ç”¨ */
        .tokkan-controls { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .tokkan-num-input { width: 60px; padding: 8px; font-size: 1rem; border-radius: 5px; border: 1px solid #ccc; text-align: center; }

        /* é …ç›®è¨­å®šãƒ¢ãƒ¼ãƒ‰ */
        .config-view { display: none; background: var(--card); padding: 20px; border-radius: 15px; width: 100%; max-width: 410px; }
        .config-section-title { font-weight: bold; margin: 20px 0 10px; padding-bottom: 5px; border-bottom: 2px solid #eee; display: flex; align-items: center; gap: 5px; }
        .config-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee; position: relative; }
        .config-item label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; color: #34495e; }
        .config-item input, .config-item textarea { width: calc(100% - 45px); padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 0.9rem; }
        .del-row-btn { background: var(--accent); color: white; border: none; border-radius: 5px; padding: 10px; cursor: pointer; position: absolute; right: 0; top: 25px; }

        .add-row-area { background: #f9f9f9; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 2px dashed #ccc; }
        .add-row-area input { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd; box-sizing: border-box; }

        .lock-btn { background: #eee; border: none; border-radius: 10px; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; }
        .lock-btn.active { background: var(--accent); color: white; }
        
        /* çµæœã‚¨ãƒªã‚¢ & ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ */
        .result-wrapper { margin-top: 20px; display: none; flex-direction: column; gap: 10px; width: 100%; max-width: 420px; }
        .result-text { padding: 15px; background: #333; color: #fff; border-radius: 8px; text-align: center; font-weight: bold; word-break: break-all; white-space: pre-wrap; }
        .copy-btn { padding: 10px; background: #555; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85rem; font-weight: bold; transition: background 0.2s; }
        .copy-btn:hover { background: #777; }
        .copy-btn.copied { background: var(--success); }

        .controls { margin-top: 20px; width: 100%; max-width: 450px; }
        .spin-btn { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        .spin-btn.tokkan-btn { background: var(--tokkan); }
    </style>
</head>
<body>

    <h2>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ­ãƒ“ãƒ¼å¤§ä¼šè¨­å®š</h2>

    <div class="tabs">
        <button id="tab-slot" class="tab-btn active" onclick="switchTab('slot')">ãƒ«ãƒ¼ãƒ«æŠ½é¸</button>
        <button id="tab-tokkan" class="tab-btn" onclick="switchTab('tokkan')">çªè²«ãƒãƒ¼ã‚¹</button>
        <button id="tab-config" class="tab-btn" onclick="switchTab('config')">é …ç›®è¨­å®š</button>
    </div>

    <div id="slot-container" class="container">
        <div class="how-to-use">
            ğŸ‘† <b>ãƒ‘ãƒãƒ«ã‚’ç›´æ¥ã‚¯ãƒªãƒƒã‚¯</b>ï¼šç‰¹å®šã®é …ç›®ã ã‘ã‚’æ‰‹å‹•ã§åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚<br>
            ğŸ”’ <b>éµãƒœã‚¿ãƒ³</b>ï¼šæŠ½é¸ã§å‹•ã‹ãªã„ã‚ˆã†ã«é …ç›®ã‚’å›ºå®šï¼ˆãƒ­ãƒƒã‚¯ï¼‰ã—ã¾ã™ã€‚
        </div>
        <div id="app" class="container"></div>
        <div id="result-wrapper-slot" class="result-wrapper">
            <div id="result-text-area" class="result-text"></div>
            <button class="copy-btn" onclick="copyToClipboard('result-text-area', this)">ğŸ“‹ çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
        <div class="controls">
            <button id="main-btn" class="spin-btn" onclick="startSpin()">æŠ½é¸é–‹å§‹ï¼</button>
        </div>
    </div>

    <div id="tokkan-container" class="container" style="display: none;">
        <div class="how-to-use" style="border-left-color: var(--tokkan);">
            ğŸƒ <b>çªè²«ãƒãƒ¼ã‚¹</b>ï¼šé¸ã°ã‚ŒãŸãƒ‘ãƒƒã‚¯ã®ã‚«ãƒ¼ãƒ‰ã®ã¿ã§æˆ¦ã†ç‰¹æ®Šãƒ«ãƒ¼ãƒ«ã§ã™ã€‚<br>
            âš ï¸ å„ãƒ‘ãƒƒã‚¯ã¯<b>é‡è¤‡ã›ãšç‹¬ç«‹ã—ã¦</b>é¸ã°ã‚Œã¾ã™ã€‚
        </div>
        <div class="tokkan-controls">
            <label style="font-weight: bold;">ä½¿ç”¨ãƒ‘ãƒƒã‚¯æ•°ï¼š</label>
            <input type="number" id="tokkan-pack-num" class="tokkan-num-input" value="4" min="1">
        </div>
        <div id="tokkan-app" class="container"></div>
        <div id="result-wrapper-tokkan" class="result-wrapper">
            <div id="tokkan-result-text" class="result-text"></div>
            <button class="copy-btn" onclick="copyToClipboard('tokkan-result-text', this)">ğŸ“‹ ãƒ‘ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
        <div class="controls">
            <button id="tokkan-main-btn" class="spin-btn tokkan-btn" onclick="startTokkanSpin()">ãƒ‘ãƒƒã‚¯ã‚’æŠ½é¸ï¼</button>
        </div>
    </div>

    <div id="config-container" class="config-view">
        <div class="config-section-title">âš™ï¸ åŸºæœ¬ãƒ«ãƒ¼ãƒ«ã®ç·¨é›†</div>
        <div class="add-row-area">
            <label style="font-weight: bold; font-size: 0.8rem;">ï¼‹ æ–°ã—ã„æŠ½é¸é …ç›®ã‚’è¿½åŠ </label>
            <input type="text" id="new-row-name" placeholder="é …ç›®åï¼ˆä¾‹ï¼šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰">
            <button class="tab-btn active" style="width: 100%;" onclick="addNewRow()">è¿½åŠ ã™ã‚‹</button>
        </div>
        <div id="config-editor"></div>

        <div class="config-section-title">ğŸƒ çªè²«ãƒãƒ¼ã‚¹ç”¨ãƒ‘ãƒƒã‚¯ãƒªã‚¹ãƒˆ</div>
        <div class="config-item">
            <textarea id="tokkan-list-editor" style="width:100%; height:100px; padding:10px; border-radius:5px; border:1px solid #ccc;"></textarea>
        </div>

        <button class="spin-btn" style="margin-top: 10px;" onclick="saveConfig()">è¨­å®šã‚’åæ˜ ã™ã‚‹</button>
    </div>

<script>
let CONFIG = [
    { id: "match", name: "å¯¾æˆ¦æ•°", items: ["BO1", "2ãƒ‡ãƒƒã‚­BO1","BO3", "BO5"] },
    { id: "hp", name: "ä½“åŠ›", items: ["10", "15", "20", "25", "30", "35", "40", "45", "50"] },
    { id: "pp", name: "PPæœ€å¤§å€¤", items: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10"] },
    { id: "rarity", name: "ç¦æ­¢ãƒ¬ã‚¢", items: ["ãªã—", "ãƒ–ãƒ­ãƒ³ã‚º", "ã‚·ãƒ«ãƒãƒ¼", "ã‚´ãƒ¼ãƒ«ãƒ‰", "ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰"] },
    { id: "leader", name: "ç¦æ­¢ã‚¯ãƒ©ã‚¹", items: ["ãªã—", "ã‚¨ãƒ«ãƒ•", "ãƒ­ã‚¤ãƒ¤ãƒ«", "ã‚¦ã‚£ãƒƒãƒ", "ãƒ‰ãƒ©ã‚´ãƒ³", "ãƒŠã‚¤ãƒˆãƒ¡ã‚¢", "ãƒ“ã‚·ãƒ§ãƒƒãƒ—", "ãƒãƒ¡ã‚·ã‚¹"] },
    { id: "ban_pack", name: "ç¦æ­¢ãƒ‘ãƒƒã‚¯", items: ["ãªã—", "ä¼èª¬ã®å¹•é–‹ã‘", "ã‚¤ãƒ³ãƒ•ã‚£ãƒ‹ãƒ†ã‚£ãƒ»ã‚¨ãƒœãƒ«ãƒ´", "çµ¶å‚‘ã®ç¶™æ‰¿è€…", "è’¼ç©ºã®å…­ç«œ", "èŠ±é…”éŠæˆ¯", "ã‚¢ãƒã‚«ãƒªãƒ—ã‚¹ãƒ»ãƒ‘ã‚¯ãƒˆ"] }
];
let states = CONFIG.map(() => ({ currentIndex: 0, locked: false }));
states[1].currentIndex = 2; 

let TOKKAN_PACKS = ["ä¼èª¬ã®å¹•é–‹ã‘", "ã‚¤ãƒ³ãƒ•ã‚£ãƒ‹ãƒ†ã‚£ãƒ»ã‚¨ãƒœãƒ«ãƒ´", "çµ¶å‚‘ã®ç¶™æ‰¿è€…", "è’¼ç©ºã®å…­ç«œ", "èŠ±é…”éŠæˆ¯", "ã‚¢ãƒã‚«ãƒªãƒ—ã‚¹ãƒ»ãƒ‘ã‚¯ãƒˆ"];
let isSpinning = false;

function switchTab(mode) {
    document.getElementById('slot-container').style.display = (mode === 'slot') ? 'flex' : 'none';
    document.getElementById('tokkan-container').style.display = (mode === 'tokkan') ? 'flex' : 'none';
    document.getElementById('config-container').style.display = (mode === 'config') ? 'block' : 'none';
    document.getElementById('tab-slot').classList.toggle('active', mode === 'slot');
    document.getElementById('tab-tokkan').classList.toggle('active', mode === 'tokkan');
    document.getElementById('tab-config').classList.toggle('active', mode === 'config');
    if (mode === 'config') renderConfigEditor();
    if (mode === 'slot') render();
}

function copyToClipboard(elementId, btn) {
    const text = document.getElementById(elementId).innerText;
    navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.innerText;
        btn.innerText = "âœ… ã‚³ãƒ”ãƒ¼å®Œäº†ï¼";
        btn.classList.add('copied');
        setTimeout(() => {
            btn.innerText = originalText;
            btn.classList.remove('copied');
        }, 2000);
    });
}

function addNewRow() {
    const name = document.getElementById('new-row-name').value.trim();
    if (!name) return;
    CONFIG.push({ id: "custom-" + Date.now(), name: name, items: ["ãªã—", "ã‚ã‚Š"] });
    states.push({ currentIndex: 0, locked: false });
    document.getElementById('new-row-name').value = "";
    renderConfigEditor();
}

function deleteRow(idx) {
    CONFIG.splice(idx, 1);
    states.splice(idx, 1);
    renderConfigEditor();
}

function renderConfigEditor() {
    const editor = document.getElementById('config-editor');
    editor.innerHTML = CONFIG.map((conf, idx) => {
        // ç¦æ­¢ãƒ‘ãƒƒã‚¯(ban_pack)ã®å ´åˆã¯textareaã§è¡¨ç¤ºã™ã‚‹
        const isBanPack = conf.id === "ban_pack";
        const inputField = isBanPack 
            ? `<textarea id="input-${idx}" style="width:calc(100% - 45px); height:80px; padding:10px;">${conf.items.join('ã€')}</textarea>`
            : `<input type="text" id="input-${idx}" value="${conf.items.join('ã€')}">`;
        
        return `
            <div class="config-item">
                <label>${conf.name}</label>
                ${inputField}
                <button class="del-row-btn" onclick="deleteRow(${idx})" ${isBanPack ? 'style="top:35px"' : ''}>âœ–</button>
            </div>
        `;
    }).join('');
    document.getElementById('tokkan-list-editor').value = TOKKAN_PACKS.join('ã€');
}

function saveConfig() {
    CONFIG.forEach((conf, idx) => {
        const field = document.getElementById(`input-${idx}`);
        conf.items = field.value.split(/[ã€,]/).map(s => s.trim()).filter(s => s !== "");
        if (states[idx].currentIndex >= conf.items.length) states[idx].currentIndex = 0;
    });
    TOKKAN_PACKS = document.getElementById('tokkan-list-editor').value.split(/[ã€,]/).map(s => s.trim()).filter(s => s !== "");
    alert("åæ˜ ã•ã‚Œã¾ã—ãŸï¼");
    switchTab('slot');
}

function render(isFinished = false) {
    const app = document.getElementById('app');
    app.innerHTML = '';
    CONFIG.forEach((config, idx) => {
        const row = document.createElement('div');
        row.className = `slot-row ${isFinished ? 'finished' : ''}`;
        row.innerHTML = `
            <div class="label">${config.name}</div>
            <div class="picker-viewport" onclick="manualSelect(${idx})">
                <div class="picker-list" id="list-${idx}" style="transform: translateY(-${states[idx].currentIndex * 50}px)">
                    ${config.items.map(item => `<div class="picker-item">${item}</div>`).join('')}
                </div>
            </div>
            <button class="lock-btn ${states[idx].locked ? 'active' : ''}" onclick="toggleLock(${idx})">
                ${states[idx].locked ? 'ğŸ”’' : 'ğŸ”“'}
            </button>
        `;
        app.appendChild(row);
    });
    if (isFinished) showSlotResult();
}

function showSlotResult() {
    const wrapper = document.getElementById('result-wrapper-slot');
    const resArea = document.getElementById('result-text-area');
    let results = []; let bans = [];
    states.forEach((state, idx) => {
        const val = CONFIG[idx].items[state.currentIndex];
        const id = CONFIG[idx].id;
        if (id === "match") results.push(val);
        else if (id === "hp") results.push("ä½“åŠ›:" + val);
        else if (id === "pp") results.push("PP:" + val);
        else if ((id === "rarity" || id === "leader" || id === "ban_pack") && val !== "ãªã—") bans.push(val);
        else if (val !== "ãªã—") results.push(CONFIG[idx].name + ":" + val);
    });
    let banText = bans.length > 0 ? "ç¦æ­¢:" + bans.join('ã€') : "";
    if (banText) results.push(banText);
    resArea.innerText = results.join(' / ');
    wrapper.style.display = 'flex';
}

function manualSelect(idx) {
    if (isSpinning) return;
    states[idx].currentIndex = (states[idx].currentIndex + 1) % CONFIG[idx].items.length;
    render();
}

function toggleLock(idx) {
    if (isSpinning) return;
    states[idx].locked = !states[idx].locked;
    render();
}

async function startSpin() {
    if (isSpinning || CONFIG.length === 0) return;
    isSpinning = true;
    document.getElementById('result-wrapper-slot').style.display = 'none';
    let startTime = Date.now();
    const animate = () => {
        let elapsed = Date.now() - startTime;
        states.forEach((state, idx) => {
            if (state.locked) return;
            state.currentIndex = Math.floor(Math.random() * CONFIG[idx].items.length);
            document.getElementById(`list-${idx}`).style.transform = `translateY(-${state.currentIndex * 50}px)`;
        });
        if (elapsed < 500) requestAnimationFrame(animate);
        else { isSpinning = false; render(true); }
    };
    requestAnimationFrame(animate);
}

function startTokkanSpin() {
    if (isSpinning) return;
    let count = parseInt(document.getElementById('tokkan-pack-num').value);
    if (isNaN(count) || count < 1) return;
    if (count > TOKKAN_PACKS.length) {
        alert(`æœ€å¤§å€¤ ${TOKKAN_PACKS.length} ã§æŠ½é¸ã—ã¾ã™ã€‚`);
        count = TOKKAN_PACKS.length;
    }

    const app = document.getElementById('tokkan-app');
    app.innerHTML = '';
    document.getElementById('result-wrapper-tokkan').style.display = 'none';

    let shuffled = [...TOKKAN_PACKS];
    for (let i = shuffled.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    let selected = shuffled.slice(0, count);

    for (let i = 0; i < count; i++) {
        const row = document.createElement('div');
        row.className = 'slot-row';
        let pool = [...TOKKAN_PACKS].filter(p => p !== selected[i]).sort(() => Math.random() - 0.5);
        pool.unshift(selected[i]);
        row.innerHTML = `
            <div class="label">ãƒ‘ãƒƒã‚¯${i+1}</div>
            <div class="picker-viewport">
                <div class="picker-list" id="tokkan-list-${i}">
                    ${pool.map(item => `<div class="picker-item">${item}</div>`).join('')}
                </div>
            </div>
        `;
        app.appendChild(row);
    }

    isSpinning = true;
    let startTime = Date.now();
    const animate = () => {
        let elapsed = Date.now() - startTime;
        for (let i = 0; i < count; i++) {
            const el = document.getElementById(`tokkan-list-${i}`);
            if (elapsed < 1000) {
                let randomOffset = Math.floor(Math.random() * TOKKAN_PACKS.length) * 50;
                el.style.transform = `translateY(-${randomOffset}px)`;
            } else {
                el.style.transform = `translateY(0px)`;
            }
        }
        if (elapsed < 1000) requestAnimationFrame(animate);
        else {
            isSpinning = false;
            const wrapper = document.getElementById('result-wrapper-tokkan');
            const resArea = document.getElementById('tokkan-result-text');
            resArea.innerText = "ã€çªè²«ãƒãƒ¼ã‚¹ï¼šæ¡ç”¨ãƒ‘ãƒƒã‚¯ã€‘\n" + selected.join(' / ');
            wrapper.style.display = 'flex';
        }
    };
    requestAnimationFrame(animate);
}

render();
</script>
</body>
</html>